#!/usr/bin/env php

<?php

use Doctrine\ORM\EntityManager;
use Doctrine\ORM\Tools\Console\ConsoleRunner;
use Doctrine\ORM\Tools\Console\EntityManagerProvider\SingleManagerProvider;
use Psr\Container\ContainerExceptionInterface;
use Psr\Container\NotFoundExceptionInterface;
use Shared\Infrastructure\DependencyInjection\ContainerFactory;
use Shared\Infrastructure\DependencyInjection\File;
use Shared\Infrastructure\Settings\SettingsInterface;

(@include __DIR__ . '/../vendor/autoload.php') || @include __DIR__ . '/../../../autoload.php';

try {
    try {
        $settingsArray = File::require(__DIR__ . '/../config/settings.php');
    } catch (RuntimeException $e) {
        $settingsArray = File::require(__DIR__ . '/../../../../config/settings.php');
    }

    $container = ContainerFactory::create($settingsArray);
    $settings = $container->get(SettingsInterface::class);
    $entityManager = $container->get(EntityManager::class);
    $singleManagerProvider = new SingleManagerProvider($entityManager);

    ConsoleRunner::run($singleManagerProvider);

} catch (NotFoundExceptionInterface|ContainerExceptionInterface|Exception $e) {
    echo ($e->getMessage());
}